---
description: 
globs: 
alwaysApply: true
---
## 產品需求文件 (PRD) - 九宮格預覽 (Nine Box Preview) v3.1 (重構版)

**文件版本:** 1.1
**日期:** 2025-05-29

### 1. 簡介 (Introduction)

* **目標 (Goal):** 為 Glyphs 3 字型設計師提供一個 3x3 的即時預覽視窗，中央顯示當前編輯字符，周圍顯示 8 個可靈活設定的上下文參考字符，以加速設計評估與迭代。
* **目標用戶 (Target Audience):** 使用 Glyphs 3 的字型設計師。

### 2. 功能需求 (Functional Requirements)

* **FR2.1 九宮格預覽 (Grid Preview):**
    * **FR2.1.1 核心顯示:** 視窗以 3x3 網格佈局，中央顯示 Glyphs 中當前活躍的字符圖層。周圍 8 格顯示參考字符。
    * **FR2.1.2 即時更新:** 當使用者在 Glyphs 中編輯、切換字符或選擇圖層時，中央字符應即時更新。當初次開啟工具視窗和更動視窗尺寸時，整個畫面的內容應即時更新。
    * **FR2.1.3 視覺呈現:** 字符以純黑/白顯示，並自動適應 Glyphs 預覽區域的明暗主題（注意，這裡不是指MacOS系統的明暗模式）。

* **FR2.2 參考字符設定 (Context Setup):**
    * **FR2.2.1 批量輸入:** 側邊欄提供一個長文本輸入框，允許使用者輸入多個字符或以空格分隔的 Nice Names 作為參考字符來源。
    * **FR2.2.2 隨機排列:** 點擊預覽畫面區域，將觸發未被鎖定的參考字符進行重新隨機排列。
    * **FR2.2.3 字符選擇器:** 輸入框支援右鍵選單，提供從目前字型中選擇字符的功能。

* **FR2.3 字符鎖定 (Character Locking):**
    * **FR2.3.1 單格鎖定:** 側邊欄提供 8 個對應周圍格子的輸入框，允許使用者輸入單一字符或 Nice Name，以將其固定在特定位置。
    * **FR2.3.2 鎖定模式切換:** 提供一個鎖頭圖示按鈕。
        * **鎖定模式:** 啟用後，鎖定框中的字符將固定顯示，不受隨機排列影響；此時在鎖定框中輸入會即時更新對應格子。
        * **解鎖模式:** 停用後，所有格子都將參與隨機排列，鎖定框的輸入暫時失效（但內容保留）。
    * **FR2.3.3 模式影響:** 鎖定模式的狀態會影響隨機排列的行為以及鎖定框輸入是否觸發更新。

* **FR2.4 介面與互動 (Interface & Interaction):**
    * **FR2.4.1 子視窗:** 提供一個可透過標題列按鈕開關的獨立控制面板子視窗，容納所有輸入和控制項。
    * **FR2.4.2 主視窗行為:** 主視窗應為浮動面板 (Floating Panel)，可縮放、移動，並能記住其大小與側邊欄狀態。
    * **FR2.4.3 子視窗行為** 子視窗寬度是固定的，高度始終和主視窗關聯同步。隱藏標題列避免讓使用者誤觸產生不可預期的行為。
    * **FR2.4.4 縮放:** (此為 `preview_view.py` 的潛在功能，但目前由 `plugin.py` 管理 `zoomFactor`) 支援預覽內容的縮放。

### 3. 非功能需求 (Non-Functional Requirements)

* **NF3.1 相容性:** 支援 Glyphs 3.2.3 或更高版本。
* **NF3.2 效能:** 更新應流暢，不干擾設計工作。
* **NF3.3 穩定性:** 確保外掛的穩定運行。
