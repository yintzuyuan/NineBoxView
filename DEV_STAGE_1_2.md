# 階段 1.2 開發實施記錄

## 實施日期
2025-05-31

## 階段目標
確保控制面板視窗能正確初始化、顯示/隱藏，並與主視窗正確連動其位置和基本可見性。

## 完成的修改

### 1. window_controller.py
- **恢復控制面板導入和初始化**：
  - 重新導入 `ControlsPanelView`
  - 恢復控制面板的創建和初始化
  - 恢復控制面板按鈕的創建
  - 載入控制面板可見性偏好設定
- **恢復控制面板顯示邏輯**：
  - 在 `makeKeyAndOrderFront` 中恢復控制面板顯示
  - 在視窗調整大小時更新控制面板位置
  - 在視窗移動時更新控制面板位置

### 2. controls_panel_view.py
- **簡化 UI 元件回調**：
  - `textDidChange_` 方法僅記錄事件，不執行實際功能
  - `pickGlyphAction_` 方法僅記錄事件
- **添加按鈕動作存根方法**：
  - `randomizeStub_`: 隨機排列按鈕存根
  - `lockAllStub_`: 鎖定全部按鈕存根  
  - `unlockAllStub_`: 解鎖全部按鈕存根
- **修改按鈕創建**：
  - 按鈕 target 改為 self 而非 plugin
  - 按鈕 action 使用存根方法

### 3. preview_view.py
- 保持階段 1.1 的簡化繪製（僅中央字符）

### 4. plugin.py
- 保持階段 1.1 的簡化更新邏輯

## 驗收標準檢查清單

- [x] 控制面板能根據偏好設定在啟動時決定是否顯示
- [x] 控制面板的顯示/隱藏按鈕能正常切換其可見性
- [x] 控制面板的 UI 元件（搜尋框、按鈕、鎖定輸入框）已創建並可見
- [x] 無控制面板初始化相關的控制台錯誤

## 測試步驟

1. **啟動 Glyphs**
   - 開啟 Glyphs 3 應用程式
   - 開啟一個字型檔案

2. **載入外掛**
   - 從選單選擇 `Window > Nine Box Preview` 開啟外掛

3. **測試控制面板顯示**
   - 確認控制面板根據偏好設定顯示/隱藏
   - 點擊標題列的 ⚙ 按鈕，確認能切換控制面板顯示狀態

4. **測試 UI 元件可見性**
   - 確認搜尋欄位可見且可輸入文字
   - 確認隨機排列按鈕可見且可點擊
   - 確認鎖定/解鎖按鈕可見且能切換狀態
   - 確認 8 個鎖定輸入框可見
   - 確認鎖定全部/解鎖全部按鈕可見

5. **測試視窗連動**
   - 調整主視窗大小，確認控制面板高度同步調整
   - 移動主視窗，確認控制面板跟隨移動
   - 關閉再重新開啟外掛，確認控制面板狀態恢復

## 已知問題

1. **功能暫未實現**：所有 UI 元件僅記錄事件，實際功能待後續階段實現
2. **右鍵選單**：「從字型中選擇字符」選項僅記錄點擊，未實現選擇功能

## 下一步

完成階段1.2驗收後，進入階段1.3：視窗交互狀態實施。

## 階段特性標記

所有階段1.2的修改都標記了 `[階段1.2]`，方便追蹤和後續整合。
