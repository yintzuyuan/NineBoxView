# 階段 3-2 開發實施記錄

## 實施日期
2025-06-05

## 階段目標
實現「清空欄位」圖示按鈕功能，位於鎖定字符輸入框的下方。點擊時清空所有鎖定輸入框，包括數據與顯示。與鎖頭狀態的互動：若處於「🔒 上鎖」狀態，清空後立即重繪預覽；若處於「🔓 解鎖」狀態，僅清空輸入框，不影響預覽。

## 完成的修改

### 1. controls_panel_view.py

#### 佈局調整
- **修改 `_create_control_buttons` 方法**
  - 移除原本的「鎖定全部」和「解鎖全部」按鈕（註解掉，保留給未來階段）
  - 新增清空按鈕，使用 🧹 圖示（掃把 emoji）
  - 設定較大的字體大小（16.0）以凸顯圖示
  - 按鈕寬度設定為跨越整個控制面板寬度
  - 設定多語言提示文字

#### 功能實作
- **新增 `clearAllFields_` 方法**
  - 清空所有鎖定輸入框的內容（`setStringValue_("")`）
  - 備份當前的 `lockedChars` 到 `previousLockedChars`（為未來功能保留）
  - 清空 `plugin.lockedChars` 字典
  - 儲存偏好設定
  - 根據鎖頭狀態決定是否更新預覽：
    - 🔒 上鎖狀態：重新生成排列並更新預覽
    - 🔓 解鎖狀態：僅清空輸入框，不更新預覽
  - 增加階段標記 `[3.2]` 的除錯日誌

#### 佈局同步
- **修改 `layoutUI` 方法**
  - 移除原本調整「鎖定全部」和「解鎖全部」按鈕的邏輯
  - 新增調整清空按鈕位置的邏輯
  - 確保視窗大小變更時，清空按鈕能正確調整位置

## 驗收標準檢查清單

- [x] 清空按鈕顯示在鎖定輸入框下方
- [x] 使用指定的 🧹 圖示，且圖示大小適當（16pt）
- [x] 按鈕寬度跨越整個控制面板
- [x] 點擊按鈕清空所有鎖定輸入框的顯示內容
- [x] 清空 `plugin.lockedChars` 數據
- [x] 在 🔒 狀態下，清空後立即重繪預覽
- [x] 在 🔓 狀態下，清空後不影響預覽
- [x] 清空操作儲存到偏好設定中
- [x] 搜尋欄位不受清空按鈕影響
- [x] 視窗大小變更時，按鈕位置能正確調整

## 測試步驟

1. **啟動測試**
   - 開啟 Glyphs 3 應用程式
   - 開啟一個包含多個字符的字型檔案
   - 從選單選擇 `Window > Nine Box Preview` 開啟外掛

2. **基本功能測試**
   - 在搜尋欄位輸入 "ABCDEFGHIJK"
   - 在不同位置的鎖定輸入框輸入字符（如位置 0 輸入 "X"，位置 3 輸入 "Y"，位置 7 輸入 "Z"）
   - 確認清空按鈕顯示在輸入框下方，使用 🧹 圖示

3. **上鎖狀態測試**
   - 確認鎖頭按鈕顯示為 🔒
   - 點擊清空按鈕
   - 確認所有鎖定輸入框被清空
   - 確認預覽立即更新，不再顯示鎖定的字符

4. **解鎖狀態測試**
   - 重新在鎖定輸入框輸入一些字符
   - 點擊鎖頭按鈕切換到 🔓 狀態
   - 點擊清空按鈕
   - 確認所有鎖定輸入框被清空
   - 確認預覽不受影響（仍顯示之前的排列）

5. **持久性測試**
   - 清空所有輸入框後，關閉外掛視窗
   - 重新開啟外掛
   - 確認鎖定輸入框仍然是空的

6. **視窗調整測試**
   - 調整視窗大小
   - 確認清空按鈕始終保持在正確位置
   - 確認按鈕寬度隨視窗調整

## 技術細節

### 清空邏輯
- 遍歷所有 `lockFields` 並設定空字串
- 清空 `plugin.lockedChars` 字典
- 根據鎖頭狀態決定是否觸發預覽更新

### 視覺設計
- 使用 Unicode 掃把表情符號（🧹）提供直觀的視覺反饋
- 較大的字體確保圖示清晰可見
- 按鈕跨越整個面板寬度，便於點擊

## 與其他功能的互動

### 與鎖頭按鈕的互動
- 🔒 上鎖狀態：清空操作會影響預覽
- 🔓 解鎖狀態：清空操作僅影響輸入框，不影響預覽

### 與搜尋欄位的關係
- 清空按鈕不影響搜尋欄位的內容
- 搜尋欄位保持獨立運作

## 下一步

完成階段 3-2 驗收後，可以進入下一個開發階段。

## 階段特性標記

所有階段 3-2 的修改都標記了 `[3.2]`，方便追蹤和後續整合。
